<?xml version="1.0" encoding="UTF-8"?>
<ae:configurations
    xmlns:ae="http://agavi.org/agavi/config/global/envelope/1.0"
    xmlns="http://berlinonline.de/schemas/honeybee/config/data_access/1.0"
    xmlns:env="http://berlinonline.de/schemas/honeybee/config/envelope/definition/1.0"
    xmlns:xi="http://www.w3.org/2001/XInclude"
>
    <ae:configuration>
        <storage_writers>
            <storage_writer name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::domain_event::event_source::writer" class="Honeybee\Infrastructure\DataAccess\Storage\CouchDb\EventStream\EventStreamAppender">
                <connection>Default.EventSource</connection>
            </storage_writer>

            <storage_writer name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::projection.standard::view_store::writer" class="Honeybee\Infrastructure\DataAccess\Storage\Elasticsearch\Projection\ProjectionWriter">
                <connection>Default.ViewStore</connection>
                <settings>
                    <setting name="index">%{{ vendor_prefix }}-{{ package_prefix }}.index%</setting>
                    <setting name="type">%{{ vendor_prefix }}-{{ package_prefix }}-{{ type_prefix }}.standard.type%</setting>
                    <setting name="parameters">
                        <setting name="index">
                            <setting name="refresh">true</setting>
                        </setting>
                        <setting name="delete">
                            <setting name="refresh">true</setting>
                        </setting>
                    </setting>
                </settings>
            </storage_writer>
        </storage_writers>

        <storage_readers>
            <storage_reader name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::event_stream::event_source::reader" class="Honeybee\Infrastructure\DataAccess\Storage\CouchDb\EventStream\EventStreamReader">
                <connection>Default.EventSource</connection>
                <settings>
                    <setting name="design_doc">%{{ vendor_prefix }}-{{ package_prefix }}-{{ type_prefix }}.type%</setting>
                </settings>
            </storage_reader>
            <storage_reader name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::domain_event::event_source::reader" class="Honeybee\Infrastructure\DataAccess\Storage\CouchDb\DomainEvent\DomainEventReader">
                <connection>Default.EventSource</connection>
                <settings>
                    <setting name="design_doc">%{{ vendor_prefix }}-{{ package_prefix }}-{{ type_prefix }}.type%</setting>
                </settings>
            </storage_reader>

            <storage_reader name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::projection.standard::view_store::reader" class="Honeybee\Infrastructure\DataAccess\Storage\Elasticsearch\Projection\ProjectionReader">
                <connection>Default.ViewStore</connection>
                <settings>
                    <setting name="index">%{{ vendor_prefix }}-{{ package_prefix }}.index%</setting>
                    <setting name="type">%{{ vendor_prefix }}-{{ package_prefix }}-{{ type_prefix }}.standard.type%</setting>
                </settings>
                <dependencies>
                    <dependency key="resource_type">{{ vendor }}\{{ package }}\{{ type }}\Projection\Standard\{{ type }}Type</dependency>
                </dependencies>
            </storage_reader>
        </storage_readers>

        <units_of_work>
            <unit_of_work name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::domain_event::event_source::unit_of_work" class="Honeybee\Infrastructure\DataAccess\UnitOfWork\UnitOfWork">
                <event_reader>{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::event_stream::event_source::reader</event_reader>
                <event_writer>{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::domain_event::event_source::writer</event_writer>
                <dependencies>
                    <dependency key="aggregate_root_type">{{ vendor }}\{{ package }}\{{ type }}\Model\Aggregate\{{ type }}Type</dependency>
                </dependencies>
            </unit_of_work>
        </units_of_work>

        <finders>
            <finder name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::projection.standard::view_store::finder" class="Honeybee\Infrastructure\DataAccess\Finder\Elasticsearch\Projection\ProjectionFinder">
                <connection>Default.ViewStore</connection>
                <settings>
                    <setting name="index">%{{ vendor_prefix }}-{{ package_prefix }}.index%</setting>
                    <setting name="type">%{{ vendor_prefix }}-{{ package_prefix }}-{{ type_prefix }}.standard.type%</setting>
                    <setting name="log_search_query">false</setting>
                </settings>
                <dependencies>
                    <dependency key="resource_type">{{ vendor }}\{{ package }}\{{ type }}\Projection\Standard\{{ type }}Type</dependency>
                </dependencies>
            </finder>
        </finders>
        
        <query_services>
            <query_service name="{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::query_service" class="Honeybee\Infrastructure\DataAccess\Query\QueryService">
                <setting name="default_mapping">{{ type_prefix }}.standard</setting>
                <finder_mappings>
                    <finder_mapping name="{{ type_prefix }}.standard">
                        <finder>{{ vendor_prefix }}.{{ package_prefix }}.{{ type_prefix }}::projection.standard::view_store::finder</finder>
                        <query_translation class="Honeybee\Infrastructure\DataAccess\Finder\Elasticsearch\ElasticsearchQueryTranslation">
                            <setting name="multi_fields"></setting>
                            <setting name="query_filters">
                                <setting name="workflow_state">!deleted</setting>
                            </setting>
                            <setting name="dynamic_mappings"></setting>
                        </query_translation>
                    </finder_mapping>
                    <finder_mapping name="domain_event">
                        <finder>honeybee::domain_event::view_store::finder</finder>
                        <query_translation class="Honeybee\Infrastructure\DataAccess\Finder\Elasticsearch\ElasticsearchQueryTranslation" />
                    </finder_mapping>
                </finder_mappings>
            </query_service>
        </query_services>
    </ae:configuration>
</ae:configurations>
